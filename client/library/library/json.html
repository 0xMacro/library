{{var allAudits = collection('audit-works').map(a => ({...a, isPrivate: !a.report}))}}
{{var auditsWithLogos = allAudits.filter(a => a.logo)}}
{{var sortedAudits = AuditMarkdown.sortByAndTransformDate(auditsWithLogos)}}
{{JSON.stringify(sortedAudits.map(audit => {
  if (audit.isPrivate) {
    return {
      title: audit.title,
      subtitle: audit.subtitle,
      date: audit.date,
      about: 'Private report (as requested by client)',
      reportUrl: null,
      vendorLogoUrl: `https://0xmacro.com/library/vendor/${audit.logo}`,
      issues: null
    }
  }
  var match = audit.report.match('/library/audits/([^)]+)')
  return {
    title: audit.title,
    subtitle: audit.subtitle,
    date: audit.date,
    about: audit.about && AuditMarkdown.renderIssueContent(audit.about),
    reportUrl: `https://0xmacro.com${audit.report}`,
    vendorLogoUrl: `https://0xmacro.com/library/vendor/${audit.logo}`,

    issues: match && (() => {
      var output = {}
      var issues = collection(`public/${match[1]}-issues`).map(Issues.normalize)
      for (let severity of 'CHMLQGI'.split('')) {
        var subset = issues.filter(i => i.severity === severity)
        output[severity] = subset.length
      }
      return output
    })()
  }
}), null, 2)}}